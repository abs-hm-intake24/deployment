---
- import_tasks: install-nginx-yum.yml
  when: ansible_pkg_mgr == "yum"

- name: Install nginx ============================ yum
  yum: pkg=nginx state=latest enablerepo=epel
  when: ansible_os_family == "RedHat"
  become: yes

- name: Install nginx ===================== apt
  action: apt pkg={{ item }} state=latest
  become: yes
  with_items:
    - nginx
  when: ansible_pkg_mgr == "apt"

- name: Generate Diffie-Helmann parameters 
  become: yes
  command: /usr/bin/openssl dhparam -dsaparam -out /etc/nginx/dhparam.pem 2048

- name: Copy nginx config ================================= apt
  copy: src=nginx-apt.conf dest=/etc/nginx/nginx.conf backup=yes
  when: ansible_pkg_mgr == "apt"

- name: Copy nginx config ============================ yum
  copy: src=nginx-yum.conf dest=/etc/nginx/nginx.conf backup=yes
  when: ansible_pkg_mgr == "yum"

- name: Create sites-avaiable directory
  file:
    path: /etc/nginx/sites-available
    state: directory

- name: Create sites-enabled directory
  file:
    path: /etc/nginx/sites-enabled
    state: directory

- name: Disable default nginx site
  file: path=/etc/nginx/sites-enabled/default state=absent

- name: Restart nginx
  service: name=nginx state=restarted
